#+title: Guix channel for the latest commits of emacs-xyz packages

* Channel setup
https://guix.gnu.org/en/manual/devel/en/guix.html#Channels

#+begin_src scheme
(channel
 (name 'emacs-latest)
 (url "https://git.sr.ht/~akyle/guix-emacs-latest")
 (introduction
  (make-channel-introduction
   "dd804da433e4e9ccd7408a356cd4f1bec942d28b"
   (openpgp-fingerprint
    "963C 2413 0BD3 BF1B 624C  EF4C 8850 284C 20B8 078D"))))
#+end_src

* TODO Usage

The function ~emacs-xyz-latest~ will return a package using the latest commit for some emacs package that must appear in /both/ the ~emacs-latest/commits.scm~ file of this channel /and/ be defined in ~emacs-xyz~ of /you/ guix.
Since ~emacs-xyz-latest~ does not rewrite the package inputs, ~with-emacs-xyz-latest~ is provided to rewrite package inputs using all the packages in ~emacs-latest/commits.scm~.
Thus together you can have the latest commits for all the emacs packages in ~emacs-xyz~ that use ~git-fetch~.

For example, for several packages:
#+begin_src scheme
(use-modules (gnu packages emacs-xyz)
             (emacs-latest emacs-xyz))

(map with-emacs-xyz-latest
  (map emacs-xyz-latest
    (list
     emacs-vterm
     emacs-org
     emacs-magit)))
; FIXME: currently having propogated inputs of something in the list also in the list causes conflicting entries
#+end_src

* Updating

#+begin_src scheme
(use-modules (emacs-latest utils))
(write-latest-emacs-xyz "emacs-latest/commits.scm")
#+end_src

* TODO 

I should print the guix commit used to generate the latest packages.

* Sourcehut Custom Readme                                          :noexport:

https://man.sr.ht/git.sr.ht/#setting-a-custom-readme

#+begin_src sh :results silent :exports none
guix shell curl jq -- bash
jq -sR '{
    "query": "mutation UpdateRepo($id: Int!, $readme: String!) {
      updateRepository(id: $id, input: { readme: $readme }) { id }
    }", "variables": {
      "id": 251847,
      "readme": .
    } }' < README.html \
  | curl --oauth2-bearer $(pass show app/sr.ht) \
    -H "Content-Type: application/json" \
    -d@- https://git.sr.ht/query
#+end_src

